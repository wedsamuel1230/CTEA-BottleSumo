# Bottle Sumo Robot WiFi TCP 整合 - 測試和部署指南

## 🚀 部署前檢查清單

### 1. 硬體需求確認
- ✅ Raspberry Pi Pico W (注意必須是 W 版本，支援 WiFi)
- ✅ ADS1115 16-bit ADC 模組
- ✅ 4x QRE1113 紅外線感測器
- ✅ SSD1306 128x64 OLED 顯示器
- ✅ 適當的電源供應 (建議 7.4V 鋰電池)

### 2. 軟體環境準備
- ✅ Arduino IDE 2.0+ 或 Arduino IDE 1.8.19+
- ✅ Raspberry Pi Pico/RP2040 開發板套件
- ✅ 必要程式庫安裝:
  - `Adafruit ADS1X15`
  - `Adafruit GFX Library`
  - `Adafruit SSD1306`
  - `WiFi` (Pico W 內建)

### 3. WiFi 網路配置
```cpp
// 在程式中修改這些設定
const char* ssid = "您的WiFi名稱";
const char* password = "您的WiFi密碼";
const int TCP_SERVER_PORT = 4242;  // 可自訂埠號
```

## 🔧 系統測試步驟

### 階段 1: 基本功能測試
1. **感測器測試**
   ```
   上傳程式 → 開啟序列埠監視器 (115200 baud)
   期望看到: "ADS1115 初始化成功"
   檢查: 感測器讀值在合理範圍內 (0-26400)
   ```

2. **OLED 顯示測試**
   ```
   期望看到: 啟動畫面顯示 2 秒
   然後切換到: 即時系統狀態顯示
   包含: 感測器狀態、WiFi 狀態、系統頻率
   ```

3. **雙核心性能測試**
   ```
   序列埠輸出應顯示:
   - Core 0 頻率: ~100 Hz
   - Core 1 頻率: ~800+ Hz
   - 無 "感測器數據過時" 警告
   ```

### 階段 2: WiFi 連線測試
1. **WiFi 連接驗證**
   ```
   序列埠輸出查看:
   ✅ "掃描到 X 個網路"
   ✅ "WiFi 連接成功: [IP位址]"
   ✅ "TCP 伺服器啟動: Port 4242"
   
   OLED 顯示應顯示:
   ✅ "WiFi: [IP位址] ****" (信號強度)
   ✅ "TCP: Port 4242 READY"
   ```

2. **網路診斷測試**
   ```
   等待 30 秒檢查自動診斷:
   - 每 30 秒輸出 WiFi 狀態檢查
   - 每 2 分鐘輸出詳細診斷資訊
   ```

### 階段 3: TCP 伺服器功能測試
1. **基本連線測試**
   ```bash
   # Windows 命令提示字元
   telnet [機器人IP] 4242
   
   # Linux/Mac 終端機
   nc [機器人IP] 4242
   
   # 期望看到歡迎訊息和指令提示
   ```

2. **資料傳輸測試**
   ```
   測試指令順序:
   1. 'help'   → 應顯示所有可用指令
   2. 'status' → 應顯示系統狀態
   3. 'data'   → 應顯示純文字感測器數據
   4. 'json'   → 應顯示 JSON 格式數據
   ```

3. **JSON 數據格式驗證**
   ```json
   {
     "timestamp": 12345,
     "frequency": 856.23,
     "sensors": {
       "raw": [1234, 5678, 9012, 3456],
       "percentage": [4.67, 21.52, 34.15, 13.08],
       "digital": [0, 1, 1, 0]
     },
     "robot_state": "edge",
     "wifi_status": "已連接 (IP: 192.168.1.100, 訊號: -45dBm)",
     "uptime": 12345
   }
   ```

### 階段 4: 性能和穩定性測試
1. **長時間運行測試**
   ```
   運行時間: 至少 30 分鐘
   檢查項目:
   - WiFi 連線穩定性
   - 感測器讀取頻率維持
   - 記憶體洩漏 (檢查可用記憶體)
   - 無異常重啟
   ```

2. **網路中斷復原測試**
   ```
   測試步驟:
   1. 機器人正常運行後，關閉 WiFi 路由器
   2. 等待 1 分鐘，觀察自動重連嘗試
   3. 重新開啟路由器
   4. 確認自動重新連接成功
   ```

3. **負載測試**
   ```python
   # Python 自動化測試腳本
   import socket
   import time
   import json
   
   robot_ip = "192.168.1.100"  # 替換為實際 IP
   
   for i in range(100):
       try:
           s = socket.socket()
           s.settimeout(5)
           s.connect((robot_ip, 4242))
           s.send(b'json\n')
           data = s.recv(1024)
           result = json.loads(data.decode())
           print(f"Test {i+1}: Frequency = {result['frequency']:.2f} Hz")
           s.close()
           time.sleep(0.5)
       except Exception as e:
           print(f"Test {i+1} failed: {e}")
   ```

## 🐛 常見問題排除

### WiFi 連線問題
```
問題: "WiFi 連接失敗"
解決方案:
1. 檢查 SSID 和密碼是否正確
2. 確認使用 Pico W (而非一般 Pico)
3. 檢查 WiFi 頻段 (僅支援 2.4GHz)
4. 嘗試不同的 WiFi 網路
```

### TCP 連線問題
```
問題: 無法連接到 TCP 伺服器
解決方案:
1. 確認防火牆設定 (開放 4242 埠)
2. 檢查路由器是否阻擋內網通訊
3. 使用 ping 測試網路連通性
4. 嘗試不同的埠號
```

### 性能問題
```
問題: Core 1 頻率低於 800 Hz
解決方案:
1. 檢查 ADS1115 接線
2. 降低 WiFi 處理頻率 (修改 50ms 間隔)
3. 減少序列埠輸出頻率
4. 檢查電源供應穩定性
```

## 📊 效能基準

### 正常運行指標
- **Core 0 (主控)**: 80-120 Hz
- **Core 1 (感測器)**: 800-900 Hz
- **WiFi 檢查**: 每 30 秒
- **TCP 處理**: 每 50ms (20 Hz)
- **OLED 更新**: 每 500ms (2 Hz)
- **記憶體使用**: < 80% 可用記憶體

### 網路效能
- **TCP 連線建立**: < 1 秒
- **資料傳輸延遲**: < 100ms
- **WiFi 重連時間**: < 10 秒
- **同時連線數**: 建議 ≤ 3 個客戶端

## 🎯 部署建議

1. **測試環境**
   - 先在桌面環境完成所有測試
   - 確認所有功能正常後再裝到機器人上

2. **生產部署**
   - 使用穩定的 WiFi 網路
   - 考慮設置專用的機器人網路
   - 定期檢查系統日誌

3. **監控和維護**
   - 定期檢查感測器校準
   - 監控 WiFi 信號強度
   - 備份重要設定和日誌

## 📝 下一步開發建議

1. **Web 介面**: 開發簡單的 web 控制台
2. **資料記錄**: 加入 SD 卡資料記錄功能
3. **遠端控制**: 實現基本的遠端馬達控制
4. **多機器人**: 支援多機器人網路通訊
5. **雲端整合**: 連接 IoT 平台進行數據分析

---
*測試完成後，您就擁有一個具備完整 WiFi TCP 伺服器功能的高性能 Bottle Sumo 機器人系統！*